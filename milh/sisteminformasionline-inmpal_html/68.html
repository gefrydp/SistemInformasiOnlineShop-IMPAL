<html><head><title>visitor.php</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<link rel="stylesheet" type="text/css" href="sourcestyles.css" />
</head><body link="blue" vlink="blue">
<h3>File: Z:\demo\impal\SistemInformasiOnlineShop-IMPAL\includes\visitor.php</h3>
<SCRIPT>
defaultStatus = "File: Z:\\demo\\impal\\SistemInformasiOnlineShop-IMPAL\\includes\\visitor.php";
top.document.title  = "visitor.php";
</SCRIPT>
<pre><span class="default"></span><a name="1"><font size=-1>1     </font></a><span class="default">&lt;?php</span>
<a name="2"><font size=-1>2     </font></a><span class="default"></span><span class="comment">// COUNTER VISITOR //</span>
<a name="3"><font size=-1>3     </font></a><span class="comment"></span><span class="default">$<a href="dictionary_I.html#436">ip</a>      = $<a href="dictionary_Non-Alpha.html#112">_SERVER</a>[</span><span class="string">'REMOTE_ADDR'</span><span class="default">]; </span><span class="comment">// Mendapatkan IP komputer user</span>
<a name="4"><font size=-1>4     </font></a><span class="comment"></span><span class="default">$<a href="dictionary_T.html#1040">tanggal</a> = <a href="dictionary_D.html#260">date</a>(</span><span class="string">&quot;Ymd&quot;</span><span class="default">); </span><span class="comment">// Mendapatkan tanggal sekarang</span>
<a name="5"><font size=-1>5     </font></a><span class="comment"></span><span class="default">$<a href="dictionary_W.html#1128">waktu</a>   = <a href="dictionary_T.html#1069">time</a>(); </span><span class="comment">//</span>
<a name="6"><font size=-1>6     </font></a><span class="comment"> </span>
<a name="7"><font size=-1>7     </font></a><span class="comment">// Mencek berdasarkan IPnya, apakah user sudah pernah mengakses hari ini</span>
<a name="8"><font size=-1>8     </font></a><span class="comment"></span><span class="default">$<a href="dictionary_S.html#842">s</a> = <a href="dictionary_M.html#596">mysql_query</a>(</span><span class="string">&quot;SELECT * FROM t_statistika WHERE ip='</span><span class="default">$<a href="dictionary_I.html#436">ip</a></span><span class="string">' AND tanggal='</span><span class="default">$<a href="dictionary_T.html#1040">tanggal</a></span><span class="string">'&quot;</span><span class="default">);</span>
<a name="9"><font size=-1>9     </font></a><span class="default"></span>
<a name="10"><font size=-1>10     </font></a><span class="default"></span><span class="comment">// Kalau belum ada, simpan data user tersebut ke database</span>
<a name="11"><font size=-1>11     </font></a><span class="comment"></span><span class="keyword">if</span><span class="default">(<a href="dictionary_M.html#595">mysql_num_rows</a>($<a href="dictionary_S.html#842">s</a>) == </span><span class="number">0</span><span class="default">){</span>
<a name="12"><font size=-1>12     </font></a><span class="default">    <a href="dictionary_M.html#596">mysql_query</a>(</span><span class="string">&quot;INSERT INTO t_statistika(ip, tanggal, hits, online) VALUES('</span><span class="default">$<a href="dictionary_I.html#436">ip</a></span><span class="string">','</span><span class="default">$<a href="dictionary_T.html#1040">tanggal</a></span><span class="string">','1','</span><span class="default">$<a href="dictionary_W.html#1128">waktu</a></span><span class="string">')&quot;</span><span class="default">);</span>
<a name="13"><font size=-1>13     </font></a><span class="default">}</span>
<a name="14"><font size=-1>14     </font></a><span class="default"></span><span class="comment">// Jika sudah ada, update</span>
<a name="15"><font size=-1>15     </font></a><span class="comment"></span><span class="keyword">else</span><span class="default">{</span>
<a name="16"><font size=-1>16     </font></a><span class="default">    <a href="dictionary_M.html#596">mysql_query</a>(</span><span class="string">&quot;UPDATE t_statistika SET hits=hits+1, online='</span><span class="default">$<a href="dictionary_W.html#1128">waktu</a></span><span class="string">' WHERE ip='</span><span class="default">$<a href="dictionary_I.html#436">ip</a></span><span class="string">' AND tanggal='</span><span class="default">$<a href="dictionary_T.html#1040">tanggal</a></span><span class="string">'&quot;</span><span class="default">);</span>
<a name="17"><font size=-1>17     </font></a><span class="default">}</span>
<a name="18"><font size=-1>18     </font></a><span class="default"></span>
<a name="19"><font size=-1>19     </font></a><span class="default">$<a href="dictionary_P.html#702">pengunjung</a>       = <a href="dictionary_M.html#595">mysql_num_rows</a>(<a href="dictionary_M.html#596">mysql_query</a>(</span><span class="string">&quot;SELECT * FROM t_statistika WHERE tanggal='</span><span class="default">$<a href="dictionary_T.html#1040">tanggal</a></span><span class="string">' GROUP BY ip&quot;</span><span class="default">)); </span><span class="comment">// Hitung jumlah pengunjung</span>
<a name="20"><font size=-1>20     </font></a><span class="comment"></span><span class="default">$<a href="dictionary_T.html#1090">totalpengunjung</a>  = <a href="dictionary_M.html#597">mysql_result</a>(<a href="dictionary_M.html#596">mysql_query</a>(</span><span class="string">&quot;SELECT COUNT(hits) FROM t_statistika&quot;</span><span class="default">), </span><span class="number">0</span><span class="default">); </span><span class="comment">// hitung total pengunjung</span>
<a name="21"><font size=-1>21     </font></a><span class="comment"></span><span class="default">$<a href="dictionary_B.html#189">bataswaktu</a>       = <a href="dictionary_T.html#1069">time</a>() - </span><span class="number">300</span><span class="default">;</span>
<a name="22"><font size=-1>22     </font></a><span class="default">$<a href="dictionary_P.html#704">pengunjungonline</a> = <a href="dictionary_M.html#595">mysql_num_rows</a>(<a href="dictionary_M.html#596">mysql_query</a>(</span><span class="string">&quot;SELECT * FROM t_statistika WHERE online &gt; '</span><span class="default">$<a href="dictionary_B.html#189">bataswaktu</a></span><span class="string">'&quot;</span><span class="default">)); </span><span class="comment">// hitung pengunjung online</span>
<a name="23"><font size=-1>23     </font></a><span class="comment"></span><span class="default">$<a href="dictionary_H.html#366">hkemarin</a>		  = <a href="dictionary_D.html#260">date</a>(</span><span class="string">&quot;d&quot;</span><span class="default">)-</span><span class="number">1</span><span class="default">;</span>
<a name="24"><font size=-1>24     </font></a><span class="default">$<a href="dictionary_T.html#1081">tkemarin</a>		  = <a href="dictionary_D.html#260">date</a>(</span><span class="string">&quot;Y-m-&quot;</span><span class="default">).$<a href="dictionary_H.html#366">hkemarin</a>;</span>
<a name="25"><font size=-1>25     </font></a><span class="default">$<a href="dictionary_K.html#509">kemarin</a>		  = <a href="dictionary_M.html#595">mysql_num_rows</a>(<a href="dictionary_M.html#596">mysql_query</a>(</span><span class="string">&quot;SELECT *from t_statistika Where tanggal='&quot;</span><span class="default">.$<a href="dictionary_T.html#1081">tkemarin</a>.</span><span class="string">&quot;'&quot;</span><span class="default">));</span>
<a name="26"><font size=-1>26     </font></a><span class="default">?&gt;</span>
<a name="27"><font size=-1>27     </font></a><span class="default"></span>
</pre></body></html>
